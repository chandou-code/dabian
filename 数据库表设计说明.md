# 校园跑腿平台 - 数据库表设计说明

## 1. 用户相关表

### 1.1 users (用户表)
存储所有用户信息，包括普通用户、跑腿员和管理员

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 用户ID（主键） |
| username | VARCHAR | 50 | NO | - | 用户名 |
| password | VARCHAR | 255 | NO | - | 密码（BCrypt加密） |
| real_name | VARCHAR | 50 | YES | NULL | 真实姓名 |
| nickname | VARCHAR | 50 | YES | NULL | 昵称 |
| avatar | VARCHAR | 500 | YES | NULL | 头像URL |
| phone | VARCHAR | 20 | YES | NULL | 手机号 |
| email | VARCHAR | 100 | YES | NULL | 邮箱 |
| role | VARCHAR | 20 | NO | 'user' | 角色：user/runner/admin |
| is_verified | TINYINT | 1 | NO | 0 | 是否认证：0-否 1-是 |
| is_vip | TINYINT | 1 | NO | 0 | 是否VIP：0-否 1-是 |
| credit_score | INT | - | NO | 100 | 信用分 |
| college | VARCHAR | 100 | YES | NULL | 学院 |
| grade | VARCHAR | 20 | YES | NULL | 年级 |
| signature | VARCHAR | 200 | YES | NULL | 个性签名 |
| register_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 注册时间 |
| last_login_time | DATETIME | - | YES | NULL | 最后登录时间 |
| status | TINYINT | 1 | NO | 1 | 账号状态：0-禁用 1-正常 |

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_username (username)
- UNIQUE KEY uk_phone (phone)
- KEY idx_role (role)
- KEY idx_status (status)

---

### 1.2 runner_profiles (跑腿员档案表)
跑腿员的详细服务信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 档案ID（主键） |
| user_id | BIGINT | - | NO | - | 用户ID（外键） |
| service_tags | JSON | - | YES | NULL | 服务标签（数组） |
| service_area | VARCHAR | 200 | YES | NULL | 服务范围 |
| work_time | VARCHAR | 100 | YES | NULL | 工作时间（如：8:00-22:00） |
| complete_count | INT | - | NO | 0 | 完成订单数 |
| good_rate | DECIMAL | 5,2 | NO | 100.00 | 好评率（%） |
| rating_speed | DECIMAL | 3,2 | NO | 0.00 | 速度评分（1-5） |
| rating_attitude | DECIMAL | 3,2 | NO | 0.00 | 态度评分（1-5） |
| rating_quality | DECIMAL | 3,2 | NO | 0.00 | 质量评分（1-5） |

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_user_id (user_id)
- KEY idx_complete_count (complete_count)

---

### 1.3 user_reviews (用户评价表)
用户之间的评价记录

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 评价ID（主键） |
| reviewer_id | BIGINT | - | NO | - | 评价人ID |
| reviewee_id | BIGINT | - | NO | - | 被评价人ID |
| task_id | BIGINT | - | YES | NULL | 关联任务ID |
| rating | DECIMAL | 3,2 | NO | - | 评分（1-5） |
| content | TEXT | - | YES | NULL | 评价内容 |
| tags | JSON | - | YES | NULL | 标签（如：['速度快','态度好']） |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 评价时间 |

**索引：**
- PRIMARY KEY (id)
- KEY idx_reviewer_id (reviewer_id)
- KEY idx_reviewee_id (reviewee_id)
- KEY idx_task_id (task_id)

---

## 2. 跑腿任务相关表

### 2.1 errand_tasks (跑腿任务表)
所有跑腿任务信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 任务ID（主键） |
| task_no | VARCHAR | 50 | NO | - | 任务编号 |
| type | VARCHAR | 20 | NO | - | 任务类型：delivery/food/shopping/queue/document/other |
| title | VARCHAR | 100 | NO | - | 任务标题 |
| description | TEXT | - | YES | NULL | 任务描述 |
| publisher_id | BIGINT | - | NO | - | 发布人ID |
| runner_id | BIGINT | - | YES | NULL | 跑腿员ID |
| pickup_address | VARCHAR | 500 | NO | - | 取货地址 |
| pickup_detail | VARCHAR | 500 | YES | NULL | 取货详细地址 |
| pickup_lat | DECIMAL | 10,6 | YES | NULL | 取货纬度 |
| pickup_lng | DECIMAL | 10,6 | YES | NULL | 取货经度 |
| delivery_address | VARCHAR | 500 | NO | - | 送达地址 |
| delivery_detail | VARCHAR | 500 | YES | NULL | 送达详细地址 |
| delivery_lat | DECIMAL | 10,6 | YES | NULL | 送达纬度 |
| delivery_lng | DECIMAL | 10,6 | YES | NULL | 送达经度 |
| expected_time | DATETIME | - | NO | - | 期望送达时间 |
| price | DECIMAL | 10,2 | NO | - | 跑腿费用 |
| contact_phone | VARCHAR | 20 | NO | - | 联系电话 |
| remark | VARCHAR | 500 | YES | NULL | 备注信息 |
| images | JSON | - | YES | NULL | 任务图片URL数组 |
| status | VARCHAR | 20 | NO | 'pending' | 状态：pending/accepted/delivering/completed/cancelled |
| publish_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 发布时间 |
| accept_time | DATETIME | - | YES | NULL | 接单时间 |
| start_time | DATETIME | - | YES | NULL | 开始配送时间 |
| complete_time | DATETIME | - | YES | NULL | 完成时间 |
| cancel_time | DATETIME | - | YES | NULL | 取消时间 |
| cancel_reason | VARCHAR | 500 | YES | NULL | 取消原因 |

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_task_no (task_no)
- KEY idx_publisher_id (publisher_id)
- KEY idx_runner_id (runner_id)
- KEY idx_status (status)
- KEY idx_publish_time (publish_time)

---

### 2.2 task_timelines (任务进度表)
任务执行进度记录

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 进度ID（主键） |
| task_id | BIGINT | - | NO | - | 任务ID（外键） |
| step | TINYINT | 1 | NO | - | 步骤：1-已发布 2-已接单 3-配送中 4-已完成 |
| title | VARCHAR | 50 | NO | - | 步骤标题 |
| description | VARCHAR | 500 | YES | NULL | 步骤描述 |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 时间 |

**索引：**
- PRIMARY KEY (id)
- KEY idx_task_id (task_id)

---

## 3. 失物招领相关表

### 3.1 items (失物招领物品表)
所有失物和招领信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 物品ID（主键） |
| item_no | VARCHAR | 50 | NO | - | 物品编号 |
| type | VARCHAR | 20 | NO | - | 类型：lost（失物）/found（招领） |
| item_name | VARCHAR | 100 | NO | - | 物品名称 |
| category | VARCHAR | 50 | NO | - | 物品类别 |
| description | TEXT | - | YES | NULL | 物品描述 |
| lost_time | DATETIME | - | YES | NULL | 丢失/发现时间 |
| location | VARCHAR | 500 | NO | - | 丢失/发现地点 |
| contact | VARCHAR | 100 | NO | - | 联系方式（手机或邮箱） |
| publisher_id | BIGINT | - | NO | - | 发布人ID |
| images | JSON | - | YES | NULL | 物品图片URL数组 |
| ai_description | TEXT | - | YES | NULL | AI生成的描述 |
| status | VARCHAR | 20 | NO | 'pending' | 状态：pending/approved/rejected/recovered |
| reviewer_id | BIGINT | - | YES | NULL | 审核人ID |
| review_time | DATETIME | - | YES | NULL | 审核时间 |
| review_comment | VARCHAR | 500 | YES | NULL | 审核意见 |
| publish_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 发布时间 |

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_item_no (item_no)
- KEY idx_type (type)
- KEY idx_publisher_id (publisher_id)
- KEY idx_status (status)
- KEY idx_category (category)
- KEY idx_publish_time (publish_time)

---

### 3.2 item_clues (物品线索表)
用户提交的物品线索

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 线索ID（主键） |
| item_id | BIGINT | - | NO | - | 物品ID（外键） |
| provider_id | BIGINT | - | NO | - | 线索提供人ID |
| content | TEXT | - | NO | - | 线索内容 |
| contact | VARCHAR | 100 | YES | NULL | 联系方式 |
| status | VARCHAR | 20 | NO | 'pending' | 状态：pending/useful/invalid |
| reviewer_id | BIGINT | - | YES | NULL | 审核人ID |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 提供时间 |

**索引：**
- PRIMARY KEY (id)
- KEY idx_item_id (item_id)
- KEY idx_provider_id (provider_id)
- KEY idx_status (status)

---

## 4. 消息通知相关表

### 4.1 notifications (通知表)
系统通知和用户消息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 通知ID（主键） |
| user_id | BIGINT | - | NO | - | 接收人ID |
| type | VARCHAR | 20 | NO | - | 类型：system/task/item/message |
| title | VARCHAR | 200 | NO | - | 通知标题 |
| content | TEXT | - | YES | NULL | 通知内容 |
| related_id | BIGINT | - | YES | NULL | 关联对象ID |
| is_read | TINYINT | 1 | NO | 0 | 是否已读：0-否 1-是 |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (id)
- KEY idx_user_id (user_id)
- KEY idx_is_read (is_read)
- KEY idx_type (type)

---

## 5. 系统相关表

### 5.1 notices (系统公告表)
平台公告信息

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 公告ID（主键） |
| title | VARCHAR | 200 | NO | - | 公告标题 |
| content | TEXT | - | NO | - | 公告内容 |
| priority | TINYINT | 1 | NO | 0 | 优先级：0-普通 1-重要 2-紧急 |
| status | TINYINT | 1 | NO | 1 | 状态：0-下架 1-上架 |
| publisher_id | BIGINT | - | NO | - | 发布人ID |
| view_count | INT | - | NO | 0 | 浏览次数 |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引：**
- PRIMARY KEY (id)
- KEY idx_status (status)
- KEY idx_priority (priority)
- KEY idx_create_time (create_time)

---

## 6. 统计相关表

### 6.1 user_statistics (用户统计表)
用户统计数据汇总

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 统计ID（主键） |
| user_id | BIGINT | - | NO | - | 用户ID（唯一） |
| total_lost | INT | - | NO | 0 | 发布失物总数 |
| total_found | INT | - | NO | 0 | 发布招领总数 |
| recovered | INT | - | NO | 0 | 已找回数量 |
| publish_tasks | INT | - | NO | 0 | 发布任务数 |
| accept_tasks | INT | - | NO | 0 | 接单任务数 |
| complete_tasks | INT | - | NO | 0 | 完成任务数 |
| unread_notifications | INT | - | NO | 0 | 未读通知数 |
| update_time | DATETIME | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_user_id (user_id)

---

## 7. 聊天相关表

### 7.1 chats (聊天会话表)
用户之间的聊天会话

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 会话ID（主键） |
| user_id1 | BIGINT | - | NO | - | 用户1 ID |
| user_id2 | BIGINT | - | NO | - | 用户2 ID |
| last_message | VARCHAR | 500 | YES | NULL | 最后一条消息 |
| last_message_time | DATETIME | - | YES | NULL | 最后消息时间 |
| unread_count1 | INT | - | NO | 0 | 用户1未读数 |
| unread_count2 | INT | - | NO | 0 | 用户2未读数 |

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_users (user_id1, user_id2)
- KEY idx_last_message_time (last_message_time)

---

### 7.2 chat_messages (聊天消息表)
聊天消息详情

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 消息ID（主键） |
| chat_id | BIGINT | - | NO | - | 会话ID（外键） |
| sender_id | BIGINT | - | NO | - | 发送人ID |
| content | TEXT | - | NO | - | 消息内容 |
| message_type | VARCHAR | 20 | NO | 'text' | 类型：text/image/location |
| is_read | TINYINT | 1 | NO | 0 | 是否已读 |
| create_time | DATETIME | - | NO | CURRENT_TIMESTAMP | 发送时间 |

**索引：**
- PRIMARY KEY (id)
- KEY idx_chat_id (chat_id)
- KEY idx_create_time (create_time)

---

## 表关系图

```
users (用户表)
├── runner_profiles (跑腿员档案) [1:1]
├── user_reviews (用户评价) [1:N]
├── user_statistics (用户统计) [1:1]
├── errand_tasks (发布任务) [1:N]
├── errand_tasks (接单任务) [1:N]
├── items (失物招领) [1:N]
├── item_clues (线索) [1:N]
├── notifications (通知) [1:N]
├── chats (会话) [1:N]
└── notices (公告) [1:N]

errand_tasks (任务表)
├── users (发布人) [N:1]
├── users (跑腿员) [N:1]
└── task_timelines (进度) [1:N]

items (物品表)
├── users (发布人) [N:1]
├── users (审核人) [N:1]
└── item_clues (线索) [1:N]

chats (会话表)
├── users (用户1) [N:1]
├── users (用户2) [N:1]
└── chat_messages (消息) [1:N]
```

---

## 数据库配置建议

### MySQL版本
- 推荐：MySQL 8.0+
- 最低：MySQL 5.7+

### 字符集
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci

### 存储引擎
- InnoDB（支持事务和外键）

### 连接池配置
- 初始连接数：5
- 最大连接数：50
- 连接超时：30000ms

### 备份策略
- 每日全量备份
- 保留最近30天备份
- 重要数据实时同步到从库

---

## 初始化数据说明

### 默认管理员账号
- 用户名：admin
- 密码：admin（BCrypt加密后存储）
- 角色：admin

### 默认测试账号
- 用户：testuser/123456（user角色）
- 跑腿员：runner/123456（runner角色）

### 任务类型字典
- delivery：快递代取
- food：外卖代送
- shopping：物品购买
- queue：排队代办
- document：文件传递
- other：其他服务

### 物品类别字典
- 电子产品
- 钱包证件
- 书籍文具
- 生活用品
- 衣物饰品
- 体育用品
- 其他物品
